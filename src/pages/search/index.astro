---
import Navbar from "@components/Navbar.astro"
import Layout from "@layouts/Layout.astro"
import SearchInput from "@components/Search/SearchInput"
import SearchProducts from "@components/Search/SearchProducts"
import search, { TSearchGet } from "@api/search"
import { signal } from "@preact/signals"

const searchQuery = Astro.url.searchParams.get("q")
const searchedProducts = signal<TSearchGet["products"]>([])

if (searchQuery !== null) {
  searchedProducts.value = (await search.get("products", searchQuery)).products
}
---

<Layout title="Search" description="Search for products across the site.">
  <Navbar />
  <SearchInput client:load searchQuery={searchQuery} />
  <SearchProducts searchedProducts={searchedProducts.value} client:load />
</Layout>
